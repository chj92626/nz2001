<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon购物车页面</title>
    <meta name="referrer" content="never">
    <link rel="stylesheet" href="../scss/common.css">
    <link rel="stylesheet" href="../scss/shop_list.css">
    <link rel="stylesheet" href="../scss/shop_car.css">

</head>

<body>

     <!-- 页面头部开始 -->
     <header id="header" class="container-fluid clear">
        <div class="header-logo1 l">
            <a href="./index.html"><img src="../images/header_login1.png" alt=""></a>
            <div class="header_login1_text">
                <p>加入亚马逊Prime，从此免运费</p>
                <p> 亚马逊Prime会员可享海外购美/英/日/德跨境免邮，全年无限次！更有免费无限次阅读电子书服务</p>
                <a href="./Prime.html">&gt; 立即加入</a>
            </div>
        </div>
        <div class="header-text l clear">
            <div class="header-text-list">
                <div class="header-text-all">
                    <li>亚马逊设备</li>
                    <li>Kindle商店</li>
                    <li>应用程序和游戏</li>
                    <li>图片</li>
                    <li>音乐</li>
                    <li>音乐</li>
                    <li>音乐</li>
                    <li>游戏/娱乐</li>
                    <li>音像</li>
                    <li>软件</li>
                    <li>教育音像</li>
                    <li>手机/通讯</li>
                    <li>摄像/摄影</li>
                    <li>电子</li>
                    <li>数码影音</li>
                    <li>电脑/IT</li>
                    <li>办公用品</li>
                    <li>小家电</li>
                    <li>大家电</li>
                    <li>电视/音箱</li>
                    <li>家用</li>
                    <li>家具装修</li>
                    <li>宠物用品</li>
                    <li>食品</li>
                    <li>酒品</li>
                    <li>美容化妆</li>
                    <li>个护健康</li>
                    <li>母婴用品</li>
                    <li>玩具</li>
                    <li>运动户外休闲</li>
                    <li>服装鞋包</li>
                    <li>鞋靴</li>
                    <li>钟表</li>
                    <li>珠宝首饰</li>
                    <li>汽车用品</li>
                    <li>乐器</li>
                    <li>礼品卡</li>
                    <li>Z实惠</li>
                </div>
                <input class="header-text-btn" type="text" value="全部分类">
                <input type="text">
                <input value="搜索" type="text">
            </div>
        </div>
        <div class="header-logo2 l">
            <a href=""><img src="../images/header.png" alt=""></a>
        </div>
    </header>

    <!-- 导航栏开始 -->
    <nav id="nav" class="container-fluid clear">
        <div class="nav_list1">
            全部商品分类

        </div>

        <ul class="nav_ul">
            <li name='shop_car' class="shop_car"><span class='userStr'></span><span class="myLogin">我的</span>亚马逊</li>
            <li><a href="shop_list.html?cat_one_id=居家生活">居家生活</a></li>
            <li><a href="shop_list.html?cat_one_id=海外购">海外购</a> </li>
            <li><a href="shop_list.html?cat_one_id=手机相机">手机</a></li>
            <li><a href="javaScript:;">帮助</a></li>
            <li><a href="shop_list.html?cat_one_id=智能设备">智能设备</a></li>
        </ul>
        <div class="nav_list2">
            <ol class="nav_list_text">
                <li name='login' class="login login_li">
                    <div>您好，<span class="myLogin">登录</span><span class='userStr'></span></div>
                    <div>我的账号</div>
                    <div class="login_list">
                        <div name='login' class="login login_btn">立即登录</div>
                        <p class="login_list_p">新用户？<a href="../html/reg.html">免费注册</a></p>
                        <ul>
                            <li><a href="">我的账户</a></li>
                            <li><a href="">我的订单</a></li>
                            <li><a href="">我的账户余额</a></li>
                            <li><a href="">评论已购商品</a></li>
                            <li><a href="">我的心愿单</a></li>
                            <li><a href="">为我推荐</a></li>
                            <li><a href="">我的Prime会员</a></li>
                            <li><a href="">管理我的内容和设备</a></li>
                            <li><a href="">我的 Kindle Unlimited</a></li>
                            <li><a href="">我的应用程序和设备</a></li>
                            <li><a href="">我要全球开店</a></li>

                            <div id="out_login">退出登录</div>

                        </ul>
                    </div>
                </li>

                <li name='try' class="try try_li">
                    <div>免费试享</div>
                    <div>Prime</div>
                    <div class="try_list">
                        <ul>
                            <li><a href="javaScript:;"><img src="../images/prime.jpg" alt=""></a></li>
                        </ul>
                    </div>
                </li>
                <li name='shop_car' class="shop_car">购物车(<span class="car-num">0</span>)</li>
                <li name='wish' class="wish">心愿单</li>

            </ol>
        </div>
        <div class="nav_list1_text">
            <ul>
                <li>
                    <a href="shop_list.html?cat_one_id=生活电器">生活电器</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=生活电器">欧式快热炉</a> </li>
                        <li><a href="shop_list.html?cat_one_id=生活电器">加湿器</a> </li>
                        <li><a href="shop_list.html?cat_one_id=生活电器">暖风机</a> </li>
                        <li><a href="shop_list.html?cat_one_id=生活电器">小太阳</a> </li>
                        <li><a href="shop_list.html?cat_one_id=生活电器">除湿机</a> </li>
                        <li><a href="shop_list.html?cat_one_id=生活电器">扫地机器人</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=邮币乐器">邮币乐器</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=邮币乐器">电子烟</a> </li>
                        <li><a href="shop_list.html?cat_one_id=邮币乐器">工艺摆设</a> </li>
                        <li><a href="shop_list.html?cat_one_id=邮币乐器">婚庆节庆</a> </li>
                        <li><a href="shop_list.html?cat_one_id=邮币乐器">瑞士军刀</a> </li>
                        <li><a href="shop_list.html?cat_one_id=邮币乐器">影视周边</a> </li>
                        <li><a href="shop_list.html?cat_one_id=邮币乐器">电子鼓</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=食品酒水">食品酒水</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=食品酒水">食品酒水</a> </li>
                        <li><a href="shop_list.html?cat_one_id=食品酒水">食品酒水</a> </li>
                        <li><a href="shop_list.html?cat_one_id=食品酒水">食品酒水</a> </li>
                        <li><a href="shop_list.html?cat_one_id=食品酒水">食品酒水</a> </li>
                        <li><a href="shop_list.html?cat_one_id=食品酒水">食品酒水</a> </li>
                    </ol>
                </li>
                <li>
                    <a href=""><a href="shop_list.html?cat_one_id=男装">男装</a> / <a
                           href="shop_list.html?cat_one_id=女装">女装</a> /
                        <a href="shop_list.html?cat_one_id=皮具箱包">箱包</a></a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=男装">男装</a> </li>
                        <li><a href="shop_list.html?cat_one_id=男装">男装</a> </li>
                        <li><a href="shop_list.html?cat_one_id=男装">男装</a> </li>
                        <li><a href="shop_list.html?cat_one_id=男装">男装</a> </li>
                        <li><a href="shop_list.html?cat_one_id=男装">男装</a> </li>
                    </ol>
                </li>
                <li>
                    <a href=""><a href="shop_list.html?cat_one_id=珠宝首饰">珠宝首饰</a> / <a
                           href="shop_list.html?cat_one_id=内衣配饰">内衣配饰</a></a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=珠宝首饰">珠宝首饰</a> </li>
                        <li><a href="shop_list.html?cat_one_id=珠宝首饰">珠宝首饰</a> </li>
                        <li><a href="shop_list.html?cat_one_id=珠宝首饰">珠宝首饰</a> </li>
                        <li><a href="shop_list.html?cat_one_id=珠宝首饰">珠宝首饰</a> </li>
                        <li><a href="shop_list.html?cat_one_id=珠宝首饰">珠宝首饰</a> </li>
                    </ol>
                </li>
                <li>
                    <a href=""><a href="shop_list.html?cat_one_id=烹饪厨具">厨具</a> / <a
                           href="shop_list.html?cat_one_id=智能设备">智能设备</a></a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=烹饪厨具">烹饪厨具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=烹饪厨具">烹饪厨具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=烹饪厨具">烹饪厨具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=烹饪厨具">烹饪厨具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=烹饪厨具">烹饪厨具</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=童装玩具">童装玩具</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=童装玩具">童装玩具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=童装玩具">童装玩具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=童装玩具">童装玩具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=童装玩具">童装玩具</a> </li>
                        <li><a href="shop_list.html?cat_one_id=童装玩具">童装玩具</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=电脑办公">电脑办公</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=电脑办公">电脑办公</a> </li>
                        <li><a href="shop_list.html?cat_one_id=电脑办公">电脑办公</a> </li>
                        <li><a href="shop_list.html?cat_one_id=电脑办公">电脑办公</a> </li>
                        <li><a href="shop_list.html?cat_one_id=电脑办公">电脑办公</a> </li>
                        <li><a href="shop_list.html?cat_one_id=电脑办公">电脑办公</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=手机相机">手机相机</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=手机相机">手机相机</a> </li>
                        <li><a href="shop_list.html?cat_one_id=手机相机">手机相机</a> </li>
                        <li><a href="shop_list.html?cat_one_id=手机相机">手机相机</a> </li>
                        <li><a href="shop_list.html?cat_one_id=手机相机">手机相机</a> </li>
                        <li><a href="shop_list.html?cat_one_id=手机相机">手机相机</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=钟表眼镜">钟表眼镜</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=钟表眼镜">钟表眼镜</a> </li>
                        <li><a href="shop_list.html?cat_one_id=钟表眼镜">钟表眼镜</a> </li>
                        <li><a href="shop_list.html?cat_one_id=钟表眼镜">钟表眼镜</a> </li>
                        <li><a href="shop_list.html?cat_one_id=钟表眼镜">钟表眼镜</a> </li>
                        <li><a href="shop_list.html?cat_one_id=钟表眼镜">钟表眼镜</a> </li>
                    </ol>
                </li>
                <li>
                    <a href="shop_list.html?cat_one_id=海外购">海外购</a>
                    <ol class="clear">
                        <li><a href="shop_list.html?cat_one_id=海外购">海外购</a> </li>
                        <li><a href="shop_list.html?cat_one_id=海外购">海外购</a> </li>
                        <li><a href="shop_list.html?cat_one_id=海外购">海外购</a> </li>
                        <li><a href="shop_list.html?cat_one_id=海外购">海外购</a> </li>
                        <li><a href="shop_list.html?cat_one_id=海外购">海外购</a> </li>
                    </ol>
                </li>
            </ul>
        </div>
    </nav>

    <!-- 购物车二级导航 -->
    <div id="car-nav" class="container-fluid clear">
        <ul>
            <li name='shop_car' class="shop_car"><span class='userStr'></span><span class="myLogin">我的</span>亚马逊</li>
            <li><a href="javaScript:;">我的浏览记录</a></li>
            <li><a href="javaScript:;">为我推荐</a></li>
            <li><a href="javaScript:;">优化商品推荐</a></li>
            <li><a href="javaScript:;">我的个人主页</a></li>
            <li><a href="javaScript:;">了解更多</a></li>
        </ul>
    </div>

    <!-- 购物车内容 -->
    <div id="shop-car-show" class="container-fluid clear">
        <div class="container car-show clear">

            <div class="car-show1 ">
                <div class="shop-car-show-title">
                    <ul class="show-shop">
                        <li id="checkAll"  name="all">
                             全选
                        </li>
                        <li>商品介绍</li>
                        <li>价格</li>
                        <li>数量</li>
                    </ul>
                </div>
                <div class="shop-car-show-main clear">
                  
                </div>
                <div class="shop-amount">

                </div>

            </div>

            <div class="car-show2 r">
                <div class="shop-car-pay">
                    <div class="pay-btn">

                    </div>

                    <!-- 其他 -->
                    <div>
                        <p>1</p>
                        <p>1</p>
                        <p>1</p>
                        <p>1</p>
                    </div>
                </div>
            </div>
        </div>



    </div>
    <p>1</p>
    <p>1</p>
    <p>1</p>
    <!-- 页脚 -->
    <div class="container-fluid footer">
        <div class=" container footer-list clear">
            <ul>
                <li>了解我们
                    <ol>
                        <li><a href="javaScript:;">人才招聘</a></li>
                        <li><a href="javaScript:;">关于我的</a></li>
                        <li><a href="javaScript:;">新闻中心</a></li>
                    </ol>
                </li>
                <li>合作信息
                    <ol>
                        <li><a href="javaScript:;">我要开店</a></li>
                        <li><a href="javaScript:;">加入联盟</a></li>
                        <li><a href="javaScript:;">合作伙伴</a></li>
                    </ol>
                </li>
                <li>购物指南
                    <ol>
                        <li><a href="javaScript:;">付款与退款</a></li>
                        <li><a href="javaScript:;">汇款单招领</a></li>
                        <li><a href="javaScrip:;">发货与配送</a></li>
                        <li><a href="javaScript:;">退货与换货</a></li>
                    </ol>
                </li>
                <li>帮助中心
                    <ol>
                        <li><a href="javaScript:;">帮助中心</a></li>
                    </ol>
                </li>
            </ul>
            <div class="about">
                <img src="../images/logo.gif" alt="">
                <ul>
                    <li><a href="">北京</a></li><span> | </span>
                    <li><a href="">上海</a></li><span> | </span>
                    <li><a href="">杭州</a></li><span> | </span>
                    <li><a href="">广州</a></li><span> | </span>
                    <li><a href="">成都</a></li><span> | </span>
                    <li><a href="">天津</a></li>
                </ul>
                <p><a href="">使用条件</a><span> | </span><a href="">隐私声明</a></p>
                <p>版权所有 © 1996-2020，亚马逊公司或其关联公司</p>
                <p>互联网药品信息服务资格证书 (京)-非经营性-2012-0005</p>
                <p>京公网安备110105004167号增值电信业务经营许可证：合字 B2-20090004营业执照：110105001308484</p>
            </div>
        </div>
    </div>
    <!-- 返回顶部 -->
    <div class="container-fluid">
        <div class="footer-back">返回顶部</div>
    </div>

    <script src="../js/jquery.min.js"></script>
    <script src="../js/cookie.js"></script>
    <script src="../js/checkall.js"></script>

    <!-- 点击展开类别 -->
    <script>
        // 点击展开全部
        $(function () {
            $('.header-text-btn').click(function () {
                $(".header-text-all").fadeToggle(1000, "linear")
            })
        })

        // 登录后购物车变化
        $(function () {
            welcome();
            $('#out_login').click(function () {
                removeCookie('username');
                window.location.href = './index.html';
            })
            $('.nav_list1_text').css('display', 'none');
            $('.nav_list1').click(function () {
                $(".nav_list1_text").fadeToggle(1000, "linear");
            })

            // 动态生成页面
            let str = decodeURIComponent(window.location.search);
            str = str.substr(1);
            const arr = str.split('=');
            getAjax(1);

            function getAjax(page) {
                $.ajax({
                    url: '../php/goods_list.php',
                    data: {
                        cat_one_id: arr[1],
                        page: page,
                        line: 12,
                    },
                    type: 'get',
                    dataType: 'json',
                    success: function (res) {
                        console.log(res);
                        let str = ``;
                        str += `<div class="shopList-main-title">${res[0].cat_one_id}</div>`;
                        let str2 = ``;
                        res.forEach(function (item) {

                            str += `
                            
                        <li>
                            <div class="pic"><a href="../html/detail.html?goods_id=${item.goods_id}"><img src="${item.goods_big_logo}" alt=""></a></div>
                            <div>
                                <h3>${item.cat_id}</h3>
                                <p class="pice">￥<span>${item.goods_price}</span></p> 
                                <p>${item.goods_name}</p> 
                            </div>
                        </li>
                        `;
                            str2 += `
                        <div class="swiper-slide"">
                            <div class="shop_pic">
                            <a  href="../html/detail.html?goods_id=${item.goods_id}"><img src="${item.goods_small_logo}" alt=""></a>
                            <h3>${item.cat_id}</h3>
                            <p class="pice">￥<span>${item.goods_price}</span></p> 
                            <p>${item.goods_name}</p> 
                            </div>
                        </div>
                    `;

                        });
                        $('.list_ul').html(str);
                        $('.swiper-wrapper').html(str2)


                        console.log(res);


                        // 分页显示
                        $('.M-box').pagination({
                            mode: 'fixed',
                            pageCount: res[0].sumPage,
                            totalData: res[0].row,
                            current: res[0].page,
                            showData: 12,
                            activeCls: 'active',
                            coping: true,
                            homePage: '首页',
                            endPage: '末页',
                            prevContent: '上页',
                            nextContent: '下页',
                            callback: function (result) {
                                let p = result.getCurrent();
                                getAjax(p);
                            },
                        });
                    },
                });
               
            }

        })

        // 添加cookie
        function welcome() {
            let username = getCookie("username");
            if (username === null) {

                // 登录后显示登录用户名称
                $('.userStr').css('display', 'none')
                $('.myLogin').css('display', 'inline-block')

                // 点击购物车没有登陆跳转登录
                $('.shop_car').click(function () {
                    let bool = window.confirm('您还没有登录，点击确定前往登录！');
                    if (bool === true) {
                        window.location.href = `../html/login.html?${window.location.href}`;
                    }
                })
                $('.login').click(function () {
                    window.location.href = `./login.html?${window.location.href}`;
                })
               
            } else {
                $('.userStr').css('display', 'inline-block')
                $('.myLogin').css('display', 'none')
                $('.userStr').html(username);
                $('.login_btn').remove();
                $('.login_list_p').remove();
                $('.login_list ul').css('border', 'none')
                $('#out_login').css('display', 'block')
                $('.shop_car').click(function () {
                    window.location.href = './shop_car.html'
                });
                let cateArr = JSON.parse(localStorage.getItem('cart'));
        str4 = cateArr.length
        // console.log(cateArr.length)
        // console.log('???')
        $('.car-num').html(str4);
               
            }
           
        }


        // 动态生成购物车
        let cateArr = JSON.parse(localStorage.getItem('cart'));
        
        setPage(cateArr);
        function setPage(array) {
            let str = "";
            let str2 = "";
            let str3 = "";
            let NUM = 0;
            let TYPE = 0;
            let PAY = 0;


            array.forEach(function (item) {


                str += `
                        <div class="shop-list">
                        <div class="change">
                                <input name='change' type="checkbox" goods_id=${item.goods_id}  ${item.buy === true ? 'checked' : ''}
                                 >
                            </div>
                        <div class="shop-pic"><img src="${item.goods_small_logo}" alt=""></div>
                            <div class="shop-text">
                                <p>${item.goods_name}</p>
                                <p>${item.cat_two_id}-${item.cat_three_id}
                                </p>
                                <p>销售和发货商：<a href="javaScript:;">亚马逊</a></p>
                                <p><span name="del" goods_id="${item.goods_id}" >删除</span> | <span id='collect'>加入收藏夹</span></p>
                            </div>
                            <div class="shop-price"><span>￥<i>${item.goods_price}</i></span></div>
                            <div class="shop-num">
                                <button name="lost" goods_id="${item.goods_id}" ${item.num == 1 ? 'disabled' : ''}>-</button><span> ${item.num}</span><button name="add" goods_id="${item.goods_id}" ${item.num == item.goods_number ? 'disabled' : ''}>+</button>
                            </div>
                        </div>
                 `
                $('.shop-car-show-main').html(str);

                if (item.buy === true) {
                    TYPE++;           // 种类++
                    NUM += item.num;  // 数量是 += 累加
                    PAY += item.num * item.goods_price;   // 钱数是 数量*单价
                }
                str2 = `
                <p class="pay-price">小计 (<i class="i_num">${NUM}</i> 件商品):<span>￥<i>${ parseInt(PAY * 100) / 100}</i></span></p>

                    `
                $('.shop-amount').html(str2);

                str3 = `
                <p class="pay-price">小计 (<i>${NUM}</i> 件商品):<span>￥<i class='i-num'>${ parseInt(PAY * 100) / 100}</i></span></p>
                        <button name="pay" class="pay">进入结算中心</button>`;
                
                $('.pay-btn').html(str3);
                str4 =`${cateArr.length}`
                $('.car-num').html(str4);
                
            });

        };


        oDiv = document.querySelector('#shop-car-show');
        oDiv.addEventListener('click', function (e) {
            console.log(2)
            if (e.target.getAttribute('name') === 'all') {
                // 给数组中的所有数据,buy属性都设定为true

                cateArr.forEach(function (item) {
                    item.buy = !(item.buy);
                })
            }

            if (e.target.getAttribute('name') === 'change') {
                // 获取 goods_id 的属性
                let goods_id = e.target.getAttribute('goods_id');
                cateArr.forEach(function (item) {
                    // 如果当前item的goods_id 与 标签中存储的goods_id相同
                    if (item.goods_id === goods_id) {
                        // 设定 数据 的 购买数据,是复选框当前的数据
                        item.buy = $(e.target).prop('checked');
                    }

                })
            }
            if (e.target.getAttribute('name') === 'pay') {
                if($('.i-num').html() == 0){
                    console.log(($('.i-num').html()))
                    window.alert('您暂未选中要购买的商品，请选择后再试！')
                    return;
                }else{
                    window.location.href = './pay.html'

                }
               
                    
                }
            if (e.target.getAttribute('name') === 'del') {
                console.log('shanle')
                let goods_id = e.target.getAttribute('goods_id');
                cateArr.forEach(function (item, key) {
                    // 如果当前item的goods_id 与 标签中存储的goods_id相同
                    if (item.goods_id === goods_id) {
                        // 从当前的索引下标开始,删除数组中的一个数据单元
                        cateArr.splice(key, 1);
                    }
                })
            }
            // 添加
            if (e.target.getAttribute('name') === 'add') {
                // 获取 goods_id 的属性
                console.log('jia')
                let goods_id = e.target.getAttribute('goods_id');
                cateArr.forEach(function (item, key) {
                    // 如果当前item的goods_id 与 标签中存储的goods_id相同
                    if (item.goods_id === goods_id) {
                        // 购买数量++
                        item.num++;
                    }
                })
            }
            if (e.target.getAttribute('name') === 'lost') {
                // 获取 goods_id 的属性
                let goods_id = e.target.getAttribute('goods_id');
                cateArr.forEach(function (item, key) {
                    // 如果当前item的goods_id 与 标签中存储的goods_id相同
                    if (item.goods_id === goods_id) {
                        // 购买数量++
                        item.num--;
                    }
                })
            }
            setPage(cateArr);
            localStorage.setItem('cart', JSON.stringify(cateArr))

        })




        // 返回顶部
        $('.footer-back').click(function () {
            $('html , body').animate({ scrollTop: 0 }, 'slow');
        })



    </script>


</body>

</html>